---
title: "R Notebook"
output: html_notebook
---

FOR NOW: I will run an analysis excluding these people as an experiment to see how it goes. TOMORROW I will investigate who they are further




# also need to investigate the NA's:

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
```

```{r}
travel_dat <- read_rds(here("data", "places_travel-added.rds"))
```


## Look at who has the arrival and departure times as NA

Extract the pid's where any time value is NA
```{r}
pids_na_arr_dep <- travel_dat %>% 
  select(pid, arr_time3_add1, dep_time3_add1) %>%
  gather(key = "key", value = "value", -pid) %>% 
  filter(is.na(value)) %>% 
  .$pid %>% unique
```




Read the raw CHTS files, extract place file
```{r}
chts <- read_rds(here("data-raw", "chts_all_2019-05-22.rds"))
place <- chts$PLACE
```

Extract the rows with pids that have NA's for their arr/dep times
```{r}
library(magrittr)
place %<>% mutate(pid = str_c(SAMPN, PERNO, sep = "") %>% as.numeric())

pl_na <- place %>% filter(pid %in% pids_na_arr_dep)
```


Below, checking to see what arrival/departure times exist for PLANO == 1 in whole sample, and comparing to arr/dep times in `pl_na`

```{r}
pl1 <- place %>% filter(PLANO == 1) %>% select(pid, PLANO, ARR_HR, ARR_MIN, ARRTM)

pl1 %>%
  filter(!is.na(ARRTM)) %>% 
  .$ARRTM %>% 
  # unique %>% 
  View()

pl_na %>% filter(PLANO == 1) %>% 
  # select(pid, PLANO, ARR_HR, ARR_MIN, ARRTM) %>% 
  filter(!is.na(ARRTM)) %>% 
  .$ARRTM %>% 
  # unique %>% 
  View

```


All the people whose PLANO == 1, but arrival time is NOT NA are included in `pl_na`.

HOWEVER, Many of their PLANO == 1 have an ARRTM = NA. (correct formatting). So who are those people and why did they get NA's? I may need to move on to looking at the code itself for a bit. 


## WHO is in `pl_na`

Here is what I have figured out:

* All the people whose PLANO == 1, but arrival time is NOT NA are included in `pl_na`.




## Look at the code itself

### check modified place file
Compare `arrival_time_3` to `arr_time3_add1` (and the same for departure time)

Created in "02_modify-place-file.R"



# check for start/end time consistency

# investigate to make sure all start at time 1, end at time 1439 vs 1440

# NA'S in the middle?


